@echo off
set ver=1.61
SETLOCAL EnableExtensions
SetLocal EnableDelayedExpansion
Color 0a

:check
if not exist wget.exe goto echo 没有找到Wget.exe& choice /t 2 /d y /n >nul & goto exit
echo Set oDOM = WScript.GetObject(WScript.Arguments(0)) >%temp%/chkver.vbs
echo do until oDOM.readyState = "complete" >>%temp%/chkver.vbs
echo WScript.sleep 50 >>%temp%/chkver.vbs
echo loop >>%temp%/chkver.vbs
echo WScript.echo oDOM.documentElement.outerText >>%temp%/chkver.vbs
cscript //NoLogo /e:vbscript %temp%/chkver.vbs "http://hostsx.googlecode.com/svn/trunk/Opera/ver.txt">%temp%/ver.txt 2>nul
for /f %%i in (%temp%\ver.txt) do set verNew=%%i
if %ver%==%verNew% (goto dataUpgrade) else (echo 发现新版本，程序将自动更新！& choice /t 2 /d y /n >nul & goto Updates)

:Updates
echo Downloading update         ...Please wait...
echo Set oDOM = WScript.GetObject(WScript.Arguments(0)) >%temp%/Upnew.vbs
echo do until oDOM.readyState = "complete" >>%temp%/Upnew.vbs
echo WScript.sleep 200 >>%temp%/Upnew.vbs
echo loop >>%temp%/Upnew.vbs
echo WScript.echo oDOM.documentElement.outerText >>%temp%/Upnew.vbs
cscript //NoLogo /e:vbscript %temp%/Upnew.vbs "http://hostsx.googlecode.com/svn/trunk/Opera/OperaUp.Src">%temp%\OperaUp.bat
echo @echo off>%temp%\up.bat
echo echo ...Restart OperaUpTool...>>%temp%\up.bat
echo ping /n 1 127.1^>nul>>%temp%\up.bat
echo copy /y "%temp%\OperaUp.bat" "%~dp0\%~n0.bat"^>nul >>%temp%\up.bat
echo start "" "%~dp0\%~n0.bat">>%temp%\up.bat
echo Exit>>%temp%\up.bat
start %temp%\up.bat
exit

:operasimpleu
mshta vbscript:msgbox("请先注意保存数据并关闭Opera！",64,"您将要更新定制版数据!")(window.close)
taskkill /f /im opera.exe
del /f /q /s *.ini *.css *.pac >nul 2>nul
del /f /q script\ieopera.js script\Super_preloader.db.js pac/*.pac>nul 2>nul
cls
mkdir keyboard menu mouse pac toolbar script styles\web\ styles\user\ >nul 2>nul
wget http://hostsx.googlecode.com/svn/trunk/Opera/dialog.ini
wget http://yangqun.sx2.topnic.net/ADBlock.pac &move ADBlock.pac pac\
wget http://hostsx.googlecode.com/svn/trunk/Opera/pac/autoproxy.pac &move autoproxy.pac pac\
wget http://hostsx.googlecode.com/svn/trunk/Opera/pac/noads.pac &move noads.pac pac\
wget http://hostsx.googlecode.com/svn/trunk/Opera/fastforward.ini
wget http://hostsx.googlecode.com/svn/trunk/Opera/override.ini
wget http://hostsx.googlecode.com/svn/trunk/Opera/search.ini
wget http://hostsx.googlecode.com/svn/trunk/Opera/urlfilter.ini
wget http://hostsx.googlecode.com/svn/trunk/Opera/standard_keyboard.ini &move standard_keyboard.ini keyboard\
wget http://hostsx.googlecode.com/svn/trunk/Opera/standard_menu.ini &move standard_menu.ini menu\
wget http://hostsx.googlecode.com/svn/trunk/Opera/standard_mouse.ini &move standard_mouse.ini mouse\
wget http://hostsx.googlecode.com/svn/trunk/Opera/standard_toolbar.ini &move standard_toolbar.ini toolbar\
wget http://hostsx.googlecode.com/svn/trunk/Opera/styles/user/AdFilter.css &move AdFilter.css styles\user\
wget http://hostsx.googlecode.com/svn/trunk/Opera/styles/user/BBS.css &move BBS.css styles\user\
wget http://hostsx.googlecode.com/svn/trunk/Opera/styles/user/Classid.css &move Classid.css styles\user\
wget http://hostsx.googlecode.com/svn/trunk/Opera/styles/user/DisableMarquee.css &move DisableMarquee.css styles\user\
wget http://hostsx.googlecode.com/svn/trunk/Opera/styles/user/Gray.css &move Gray.css styles\user\
wget http://hostsx.googlecode.com/svn/trunk/Opera/styles/user/Green.css &move Green.css styles\user\
wget http://hostsx.googlecode.com/svn/trunk/Opera/styles/user/Picture.css &move Picture.css styles\user\
wget http://hostsx.googlecode.com/svn/trunk/Opera/styles/user/SimpleU.css &move SimpleU.css styles\user\
wget http://hostsx.googlecode.com/svn/trunk/Opera/styles/user/TextAligh.css &move TextAligh.css styles\user\
wget http://hostsx.googlecode.com/svn/trunk/Opera/styles/user/Visited.css &move Visited.css styles\user\
wget http://hostsx.googlecode.com/svn/trunk/Opera/styles/web/115.css &move 115.css styles\web\
wget http://hostsx.googlecode.com/svn/trunk/Opera/styles/web/163.css &move 163.css styles\web\
wget http://hostsx.googlecode.com/svn/trunk/Opera/styles/web/autohome.css &move autohome.css styles\web\
wget http://hostsx.googlecode.com/svn/trunk/Opera/styles/web/baidu.css &move baidu.css styles\web\
wget http://hostsx.googlecode.com/svn/trunk/Opera/styles/web/gmail.css &move gmail.css styles\web\
wget http://hostsx.googlecode.com/svn/trunk/Opera/styles/web/image.css &move image.css styles\web\
wget http://hostsx.googlecode.com/svn/trunk/Opera/styles/web/OS.X.Greader.css &move OS.X.Greader.css styles\web\
wget http://hostsx.googlecode.com/svn/trunk/Opera/styles/web/OS.X.OperaChina.css &move OS.X.OperaChina.css styles\web\
wget http://hostsx.googlecode.com/svn/trunk/Opera/styles/web/renren.css &move renren.css styles\web\
wget http://hostsx.googlecode.com/svn/trunk/Opera/styles/web/sina.css &move sina.css styles\web\
wget http://hostsx.googlecode.com/svn/trunk/Opera/styles/web/sohu.css &move sohu.css styles\web\
wget http://hostsx.googlecode.com/svn/trunk/Opera/styles/web/u17.css &move u17.css styles\web\
wget http://hostsx.googlecode.com/svn/trunk/Opera/Super_preloader.db.js &move Super_preloader.db.js script\
rem wget http://hostsx.googlecode.com/svn/trunk/Opera/SiteFix.js &move SiteFix.js script\
wget http://hostsx.googlecode.com/svn/trunk/Opera/ieopera.js &move ieopera.js script\
cls&start /min iexplore http://goo.gl/YxZWw
echo You are Using the Latest Version.*当前版本数据已经是最新 & choice /t 2 /d y /n >nul&exit
